app-id: zone.xiv.novus
runtime: org.kde.Platform
runtime-version: '6.10'
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: novus-launcher
build-options:
  append-path: /usr/lib/sdk/rust-stable/bin
  build-args:
    - --share=network
cleanup:
  - /include
  - /lib
  - "*.cmake"
  - "*.pc"
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --device=dri
modules:
  - name: glm
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/g-truc/glm.git
        tag: 1.0.2
  - name: json
    buildsystem: cmake-ninja
    config-opts:
      - -DJSON_BuildTests=OFF
    sources:
      - type: git
        url: https://github.com/nlohmann/json.git
        tag: v3.12.0
  - name: stb
    buildsystem: simple
    build-commands:
      - cp -r ./* -t ${FLATPAK_DEST}/include
    sources:
      - type: git
        url: https://github.com/nothings/stb.git
        commit: f1c79c02822848a9bed4315b12c8c8f3761e1296
  - name: spirv-headers
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DSPIRV_SKIP_EXECUTABLES=ON
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://github.com/KhronosGroup/SPIRV-Headers.git
        tag: vulkan-sdk-1.4.328.1
  - name: spirv-cross
    buildsystem: cmake-ninja
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://github.com/KhronosGroup/SPIRV-Cross.git
        tag: vulkan-sdk-1.4.328.1
  - name: glslang
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DGLSLANG_TESTS=OFF
      - -DENABLE_OPT=OFF
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://github.com/KhronosGroup/glslang.git
        tag: 16.0.0
  - name: corrosion
    buildsystem: cmake-ninja
    config-opts:
      - -DCORROSION_BUILD_TESTS=OFF
    build-options:
      env:
        - CARGO_HOME: /run/build/corrosion/cargo
    cleanup:
      - /app
    sources:
      - type: git
        url: https://github.com/AndrewGaspar/corrosion.git
        tag: v0.5.2
  - name: novus
    buildsystem: cmake-ninja
    config-opts:
      - -DRust_COMPILER=/usr/lib/sdk/rust-stable/bin/rustc
      - -DBUILD_FLATPAK=ON
    build-options:
      build-args:
        - --share=network # needed for cargo unfortunately, flatpak has no native support (yet)
    sources:
      - type: dir
        path: .
